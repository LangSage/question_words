<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Question Words Trainer ‚Äî Levels</title>
  <!-- Bootstrap 5.0.2 (per your preference) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <style>
    :root { --brand:#0d6efd; }
    body { background:#f8f9fa; }
    .card { border:none; box-shadow:0 6px 18px rgba(0,0,0,.06); border-radius:1rem; }
    .wchip { display:inline-block; padding:.25rem .5rem; border-radius:.5rem; background:#e9f2ff; color:#0b5ed7; font-weight:600; margin:.125rem; }
    .answer-pill { border-radius:.75rem; }
    .correct { border:2px solid #28a745 !important; background:#e8f9ee !important; }
    .wrong { border:2px solid #dc3545 !important; background:#fde8ea !important; }
    .dropzone { min-height:44px; border:2px dashed #ced4da; border-radius:.75rem; padding:.25rem .5rem; background:#fff; }
    .dropzone.filled { border-style:solid; }
    .kbd {font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
    .smallcaps { font-variant: all-small-caps; letter-spacing: .04em; }
    .star { font-size: 1.6rem; filter: drop-shadow(0 2px 3px rgba(0,0,0,.15)); }
    .star.on { color:#ffc107; }
    .level-btn { border-radius:.75rem; }
    .timer-badge { font-weight:700; }
  </style>
</head>
<body>
  <div class="container py-4 py-md-5">
    <header class="mb-4 text-center">
      <h1 class="h2 fw-bold mb-2">Question Words Trainer</h1>
    </header>

    <!-- Quick Stats -->
    <div class="row g-3 mb-4">
      <div class="col-6 col-md-3">
        <div class="card p-3 text-center">
          <div class="small text-muted">Score</div>
          <div class="display-6" id="statScore">0</div>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="card p-3 text-center">
          <div class="small text-muted">Streak</div>
          <div class="display-6" id="statStreak">0</div>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="card p-3 text-center">
          <div class="small text-muted">Tasks</div>
          <div class="display-6" id="statTasks">0</div>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="card p-3 text-center">
          <div class="small text-muted">Accuracy</div>
          <div class="display-6" id="statAcc">0%</div>
        </div>
      </div>
    </div>

    <!-- Level Selector -->
    <div class="card p-3 p-md-4 mb-4">
      <div class="d-flex flex-wrap align-items-center justify-content-between gap-2">
        <div>
          <div class="small text-muted">Choose Level</div>
          <div class="btn-group" role="group" aria-label="Levels">
            <button class="btn btn-outline-primary level-btn" data-level="1">Level 1</button>
            <button class="btn btn-outline-primary level-btn" data-level="2">Level 2</button>
            <button class="btn btn-outline-primary level-btn" data-level="3">Level 3</button>
            <button class="btn btn-outline-primary level-btn" data-level="4">Level 4</button>
            <button class="btn btn-outline-primary level-btn" data-level="5">Level 5</button>
          </div>
        </div>
        
          <span id="timer" class="badge bg-light text-dark timer-badge">--</span>
        </div>
      </div>
      <div class="mt-2 small text-muted">Hotkeys: <span class="kbd">Enter</span> to check; <span class="kbd">N</span> next.</div>
    </div>

    <!-- Task Area -->
    <div id="area" class="mb-4"></div>

    <!-- Cheat Sheet -->
    <div class="card p-3 p-md-4">
      <div class="d-flex align-items-center justify-content-between">
        <h2 class="h5 mb-0">Cheat Sheet</h2>
        <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="collapse" data-bs-target="#sheet">Show/Hide</button>
      </div>
      <div class="collapse show mt-3" id="sheet">
        <div class="mb-2">
          <span class="wchip">what ‚Äî —á—Ç–æ</span>
          <span class="wchip">where ‚Äî –≥–¥–µ</span>
          <span class="wchip">when ‚Äî –∫–æ–≥–¥–∞</span>
          <span class="wchip">who ‚Äî –∫—Ç–æ</span>
          <span class="wchip">why ‚Äî –ø–æ—á–µ–º—É</span>
          <span class="wchip">which ‚Äî –∫–∞–∫–æ–π/–∫–æ—Ç–æ—Ä—ã–π</span>
          <span class="wchip">whose ‚Äî —á–µ–π</span>
          <span class="wchip">how ‚Äî –∫–∞–∫</span>
          <span class="wchip">how much ‚Äî —Å–∫–æ–ª—å–∫–æ (–Ω–µ–∏—Å—á–∏—Å–ª.)</span>
          <span class="wchip">how many ‚Äî —Å–∫–æ–ª—å–∫–æ (–∏—Å—á–∏—Å–ª.)</span>
          <span class="wchip">how often ‚Äî –∫–∞–∫ —á–∞—Å—Ç–æ</span>
          <span class="wchip">how long ‚Äî –∫–∞–∫ –¥–æ–ª–≥–æ</span>
          <span class="wchip">how far ‚Äî –∫–∞–∫ –¥–∞–ª–µ–∫–æ</span>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  <script>
    // ===== Data =====
    const WORDS = [
      'what','where','when','who','why','which','whose','how',
      'how much','how many','how often','how long','how far'
    ];

    const FILL_BANK = [
      {b:"___ is your favorite subject?", a:"what", h:"specific info"},
      {b:"___ are you from?", a:"where", h:"place"},
      {b:"___ is your birthday?", a:"when", h:"time/date"},
      {b:"___ is standing at the door?", a:"who", h:"person"},
      {b:"___ are you late?", a:"why", h:"reason"},
      {b:"___ color do you prefer ‚Äî red or blue?", a:"which", h:"choice"},
      {b:"___ bag is this?", a:"whose", h:"possession"},
      {b:"___ do you come to college? By bus or on foot?", a:"how", h:"manner"},
      {b:"___ milk do we need for pancakes?", a:"how much", h:"uncountable"},
      {b:"___ students are in your group?", a:"how many", h:"countable"},
      {b:"___ do you travel? (every day/once a week)", a:"how often", h:"frequency"},
      {b:"___ is the lesson? (60 minutes)", a:"how long", h:"duration"},
      {b:"___ is your college from your house?", a:"how far", h:"distance"},
      {b:"At ___ time does the lesson start?", a:"what", h:"what time"},
      {b:"___ of these two options is cheaper?", a:"which", h:"limited set"},
      {b:"___ are you feeling today?", a:"how", h:"state"},
      {b:"___ do you need this document?", a:"why", h:"reason"},
      {b:"___ city would you like to visit next?", a:"which", h:"choice"},
      {b:"___ is your best friend‚Äôs name?", a:"what", h:"specific"},
      {b:"___ does the museum open on weekends?", a:"when", h:"time"}
    ];

    const MATCH_BANK = [
      {q:"Where do you study?", a:"In Pavlovsky Posad College."},
      {q:"When do you get up?", a:"At 7 a.m."},
      {q:"Who teaches you English?", a:"Mr. Andrey."},
      {q:"Why are you laughing?", a:"Because it‚Äôs funny!"},
      {q:"How many dogs do you have?", a:"Two."},
      {q:"How long is the film?", a:"About two hours."},
      {q:"How much water do you drink daily?", a:"Around two liters."},
      {q:"How far is the station?", a:"About 2 kilometers."},
      {q:"Whose jacket is this?", a:"It‚Äôs Lena‚Äôs."},
      {q:"Which color do you like more?", a:"Blue."},
      {q:"How often do you read books?", a:"Every evening."},
      {q:"What‚Äôs your dream job?", a:"Designer."}
    ];

    const SPEED_BANK = [
      {prompt:"(specific info) ____ is your name?", a:"what"},
      {prompt:"(place) ____ do you live?", a:"where"},
      {prompt:"(time) ____ do you arrive?", a:"when"},
      {prompt:"(person) ____ called you?", a:"who"},
      {prompt:"(reason) ____ are you late?", a:"why"},
      {prompt:"(choice) ____ color do you choose?", a:"which"},
      {prompt:"(possession) ____ book is this?", a:"whose"},
      {prompt:"(manner) ____ do you go to work?", a:"how"},
      {prompt:"(uncountable) ____ sugar do we need?", a:"how much"},
      {prompt:"(countable) ____ students were absent?", a:"how many"},
      {prompt:"(frequency) ____ do you clean the room?", a:"how often"},
      {prompt:"(duration) ____ is the break?", a:"how long"},
      {prompt:"(distance) ____ is the station?", a:"how far"}
    ];

    // ===== Levels =====
    // Each level has a type and always uses the full bank (max) for that type.
    const LEVELS = {
      1: { name:'Fill-in Basics', type:'fill', timer:null },
      2: { name:'Fill-in Extended', type:'fill', timer:null },
      3: { name:'Question ‚Üí Options', type:'match', timer:null },
      4: { name:'Speed Round', type:'speed', timer:60 },
      5: { name:'Speed ‚Äî Challenge', type:'speed', timer:45 }
    };

    // ===== State =====
    let score=0, streak=0, tasks=0, correctTotal=0, mistakes=0;
    let currentSet=[], currentIndex=0, currentLevel=1, currentMode='fill';
    let speedTimer=null, 

    function shuffle(arr){ return arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]); }
    function updateStats(){
      document.getElementById('statScore').textContent=score;
      document.getElementById('statStreak').textContent=streak;
      document.getElementById('statTasks').textContent=tasks;
      const acc = tasks? Math.round((correctTotal/tasks)*100):0;
      document.getElementById('statAcc').textContent=acc+"%";
    }
    function setTimerBadge(v){ document.getElementById('timer').textContent = (v==null? '--' : v+'s'); }

    // ===== Level boot =====
    function startLevel(lv){
      currentLevel = lv; const cfg = LEVELS[lv];
      currentMode = cfg.type; mistakes = 0; speedScore = 0; currentIndex = 0;
      if(cfg.type==='fill') { currentSet = FILL_BANK.slice(); }
      if(cfg.type==='match'){ currentSet = MATCH_BANK.slice(); }
      if(cfg.type==='speed'){ currentSet = SPEED_BANK.slice(); }
      // full set, but random order
      currentSet = shuffle(currentSet);
      if(cfg.type==='speed'){    renderSpeed(); }
      else { clearInterval(speedTimer);  cfg.type==='fill' ? renderFillItem() : renderMatch(); }
      // mark active level button
      document.querySelectorAll('.level-btn').forEach(b=>{
        b.classList.toggle('btn-primary', b.dataset.level==lv);
        b.classList.toggle('btn-outline-primary', b.dataset.level!=lv);
      });
    }

    // ===== Common helpers =====
    function nextItem(){
      if(currentIndex < currentSet.length-1){
        currentIndex++;
        if(currentMode==='fill') renderFillItem();
        else if(currentMode==='match') renderMatch();
        else if(currentMode==='speed') renderSpeed();
      } else {
        endLevel();
      }
    }

    function starsFromMistakes(m){
      if(m===0) return 5;
      if(m<=2) return 4;
      if(m<=4) return 3;
      if(m<=6) return 2;
      return 1;
    }

    function starHTML(n){
      let out='';
      for(let i=1;i<=5;i++) out += `<span class="star ${i<=n?'on':''}">‚òÖ</span>`;
      return out;
    }

    function endLevel(){
      clearInterval(speedTimer);
      const stars = starsFromMistakes(mistakes);
      const acc = tasks? Math.round((correctTotal/tasks)*100):0;
      const title = mistakes===0? 'Perfect run!':'Level complete';
      const html = `
        <div class="card p-4 text-center">
          <h3 class="h4 mb-2">${title} üéâ</h3>
          <div class="mb-2">${starHTML(stars)}</div>
          <p class="text-muted mb-1">Mistakes: <strong>${mistakes}</strong> ‚Ä¢ Accuracy: <strong>${acc}%</strong> ‚Ä¢ Score: <strong>${score}</strong></p>
          <div class="d-grid d-md-flex justify-content-center gap-2 mt-2">
            <button class="btn btn-primary" id="again">Replay Level ${currentLevel}</button>
            <button class="btn btn-outline-secondary" id="nextLvl">Next Level</button>
            <button class="btn btn-outline-dark" id="review">Review Items</button>
          </div>
        </div>`;
      document.getElementById('area').innerHTML = html;
      document.getElementById('again').onclick = () => startLevel(currentLevel);
      document.getElementById('nextLvl').onclick = () => startLevel(Math.min(5, currentLevel+1));
      document.getElementById('review').onclick = reviewLast;
    }

    // ===== Fill-in =====
    function renderFillItem(){
      const item = currentSet[currentIndex];
      const opts = shuffle(WORDS).slice(0,6);
      if(!opts.includes(item.a)) { opts[Math.floor(Math.random()*opts.length)] = item.a; }
      const pills = opts.map(w=>`<button type=\"button\" class=\"btn btn-outline-primary answer-pill me-2 mb-2\" data-word=\"${w}\">${w}</button>`).join('');

      const html = `
        <div class=\"card p-3 p-md-4\">
          <div class=\"d-flex justify-content-between align-items-center mb-2\">
            <div class=\"small text-muted\">Level ${currentLevel} ‚Äî Question ${currentIndex+1} / ${currentSet.length}</div>
            <div class=\"small text-muted\">Hint: ${item.h}</div>
          </div>
          <h3 class=\"h5 mb-3\">${item.b.replace('___', '<span class=\\"fw-bold text-primary\\">(choose)</span>')}</h3>
          <div class=\"mb-2\" id=\"fillPills\">${pills}</div>
          <div class=\"d-grid d-md-flex gap-2\">
            <button id=\"btnCheck\" class=\"btn btn-success\" disabled>Check</button>
            <button id=\"btnNext\" class=\"btn btn-outline-secondary\" disabled>Next</button>
          </div>
          <div class=\"mt-3\" id=\"feedback\"></div>
        </div>`;

      document.getElementById('area').innerHTML = html;

      let picked = null;
      document.querySelectorAll('#fillPills .answer-pill').forEach(btn=>{
        btn.addEventListener('click',()=>{
          document.querySelectorAll('#fillPills .answer-pill').forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          picked = btn.dataset.word;
          document.getElementById('btnCheck').disabled = false;
        });
      });

      document.getElementById('btnCheck').onclick = () => checkFill(item, picked);
      document.getElementById('btnNext').onclick = nextItem;
    }

    function checkFill(item, picked){(item){
      const val = (document.getElementById('fillInput').value||'').trim().toLowerCase();
      const ok = val === item.a;
      tasks++;
      if(ok){ score+=10; streak++; correctTotal++; }
      else { score=Math.max(0,score-2); streak=0; mistakes++; }
      updateStats();
      const fb = document.getElementById('feedback');
      fb.innerHTML = ok
        ? `<div class="alert alert-success">‚úÖ Correct! <strong>${item.a}</strong></div>`
        : `<div class="alert alert-danger">‚ùå Not quite. Correct: <strong>${item.a}</strong></div>`;
    }

    function reveal(item){
      document.getElementById('fillInput').value = item.a;
      document.getElementById('fillInput').classList.add('correct');
    }

    function reviewLast(){
      if(currentMode==='fill'){
        const list = currentSet.map((it,i)=>`<li class="list-group-item">${i+1}. ${it.b.replace('___', `<strong>${it.a}</strong>`)}</li>`).join('');
        document.getElementById('area').innerHTML = `<div class="card p-3"><ol class="list-group list-group-numbered">${list}</ol></div>`;
      } else if(currentMode==='match') {
        const list = currentSet.map((it,i)=>`<li class="list-group-item">${i+1}. <strong>${it.q}</strong> ‚Äî ${it.a}</li>`).join('');
        document.getElementById('area').innerHTML = `<div class="card p-3"><ol class="list-group list-group-numbered">${list}</ol></div>`;
      } else if(currentMode==='speed') {
        const list = currentSet.map((it,i)=>`<li class="list-group-item">${i+1}. ${it.prompt} ‚Äî <strong>${it.a}</strong></li>`).join('');
        document.getElementById('area').innerHTML = `<div class="card p-3"><ol class="list-group list-group-numbered">${list}</ol></div>`;
      }
    }

    // ===== Match (phone-friendly MCQ) =====
    function renderMatch(){
      const it = currentSet[currentIndex];
      const answers = currentSet.map(x=>x.a);
      const distractors = shuffle(answers.filter(x=>x!==it.a)).slice(0,3);
      const opts = shuffle([it.a, ...distractors]);
      const pills = opts.map((t,i)=>`<button class=\"btn btn-outline-primary answer-pill me-2 mb-2\" data-opt=\"${t}\">${i+1}. ${t}</button>`).join('');

      const html = `
        <div class=\"card p-3 p-md-4\">
          <div class=\"d-flex justify-content-between align-items-center mb-2\">
            <div class=\"small text-muted\">Level ${currentLevel} ‚Äî Question ${currentIndex+1}/${currentSet.length}</div>
            <div class=\"small text-muted\">Pick the correct answer</div>
          </div>
          <h3 class=\"h5 mb-3\">${it.q}</h3>
          <div id=\"matchPills\">${pills}</div>
          <div class=\"d-grid d-md-flex gap-2 mt-2\">
            <button id=\"matchCheck\" class=\"btn btn-success\" disabled>Check</button>
            <button id=\"btnNext2\" class=\"btn btn-outline-secondary\" disabled>Next</button>
          </div>
          <div class=\"mt-3\" id=\"feedback\"></div>
        </div>`;

      document.getElementById('area').innerHTML = html;

      let picked=null;
      document.querySelectorAll('#matchPills .answer-pill').forEach(btn=>{
        btn.addEventListener('click',()=>{
          document.querySelectorAll('#matchPills .answer-pill').forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          picked = btn.dataset.opt;
          document.getElementById('matchCheck').disabled = false;
        })
      });

      document.getElementById('matchCheck').onclick = () => {
        const ok = picked === it.a;
        tasks++;
        if(ok){ score+=5; streak++; correctTotal++; }
        else { score=Math.max(0,score-1); streak=0; mistakes++; }
        updateStats();
        document.getElementById('feedback').innerHTML = ok? `<div class=\"alert alert-success\">‚úÖ ${it.a}</div>`: `<div class=\"alert alert-danger\">‚ùå ${it.a}</div>`;
        document.getElementById('btnNext2').disabled = false;
      };
      document.getElementById('btnNext2').onclick = nextItem;
    }

    // ===== Speed =====
    function renderSpeed(){
      const it = currentSet[currentIndex];
      const opts = shuffle(WORDS).slice(0,4);
      if(!opts.includes(it.a)) opts[Math.floor(Math.random()*opts.length)] = it.a;
      const pills = opts.map((w,i)=>`<button class=\"btn btn-outline-primary answer-pill me-2 mb-2\" data-word=\"${w}\">${i+1}. ${w}</button>`).join('');
      const html = `
        <div class=\"card p-3 p-md-4\">
          <div class=\"d-flex justify-content-between align-items-center mb-2\">
            <div class=\"small text-muted\">Level ${currentLevel} ‚Äî Speed ${currentIndex+1}/${currentSet.length}</div>
            <div class=\"small text-muted\"><span id=\"spdTime\">${

      document.getElementById('area').innerHTML = html;

      let picked=null;
      document.querySelectorAll('#speedPills .answer-pill').forEach(btn=>{
        btn.addEventListener('click',()=>{
          document.querySelectorAll('#speedPills .answer-pill').forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          picked = btn.dataset.word;
          document.getElementById('spdCheck').disabled = false;
        });
      });

      document.getElementById('spdCheck').onclick = () => {
        const ok = picked===it.a;
        tasks++;
        if(ok){ score+=6; streak++; correctTotal++; speedScore+=6; }
        else { score=Math.max(0,score-1); streak=0; mistakes++; }
        updateStats();
        document.getElementById('feedback').innerHTML = ok? `<div class=\"alert alert-success\">‚úÖ ${it.a}</div>`: `<div class=\"alert alert-danger\">‚ùå ${it.a}</div>`;
        document.getElementById('spdNext').disabled = false;
      };
      document.getElementById('spdNext').onclick = nextItem;
    }

          },1000);
    }

    // ===== Wiring =====
    document.querySelectorAll('.level-btn').forEach(btn=>{
      btn.addEventListener('click', ()=> startLevel(+btn.dataset.level));
    });

    function resetAll(){ score=0; streak=0; tasks=0; correctTotal=0; mistakes=0; updateStats(); }

    window.addEventListener('keydown', (e)=>{ if(e.key.toLowerCase()==='n') nextItem(); });

    // boot: Level 1
    resetAll();
    startLevel(1);
  </script>
</body>
</html>
